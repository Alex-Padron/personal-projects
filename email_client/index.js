geometry_b3 = 
[["ZiniAlimi@sbcglobal.net", "Alimi, Kimete"],
["paul.bruno@mac.com","Bruno, Andrew T"],
["rsdenike1@hotmail.com","Denike, Alyssa C"],
["afata@lakelandschools.org","Fata, Anthony C (T.J.)"],
["aefata@sbcglobal.net","Fata, Anthony C (T.J.)"],
["egarnecho@gmail.com","Garnecho-Lopez, Davin L"],
["kiggles74@aol.com","Guariglia, Shaelyn D"],
["moneyismyshot@aol.com","Guariglia, Shaelyn D"],
["maritza1169@hotmail.com","Halas, Scot T"],
["hayden13mid@att.net","Hayden, Christopher E"],
["llambropoulos@sbcglobal.net","Lambropoulos, Stylianos (Stelios)"],
["CTMaglio@aol.com","Maglio, Julianna D"],
["donna_marciante@sbcglobal.net","Marciante, Jennifer"],
["martinson23@gmail.com","Martinson, William E"],
["nas714@msn.com","Nason, Ryan"],
["fernandapesarini@hotmail.com","Pesarini, Ana Clara A"],
["pesarini_stenio@yahoo.com","Pesarini, Ana Clara A"],
["Quinn0056@att.net","Quinn, Kerrigan A"],
["KevinQ@us.ibm.com","Quinn, Kerrigan A"],
["kwroe2211@gmail.com","Roe, Thomas S"],
["milkshakecel@aol.com","Stelzel, Andrew R"],
["allycat726@gmail.com","Turner, Jillian S"],
["lvitrit@gmail.com","Vitrit, Joseph M"],
["billiewatson1999@yahoo.com","Watson, Morgan C"],
["SandyZheng203@yahoo.com", "Zheng, Vicki"]]

geometry_b4 = 
[["anneallison423@gmail.com","Allison, Colleen V"],
["allisonharry5@yahoo.com","Allison, Colleen V"],
["palviti@footlocker.com","Alviti, Nicholas P"],
["ericalviti@sbcglobal.net","Alviti, Nicholas P"],
["ljariola24@gmail.com","Ariola, Elena M"],
["nsariola@gmail.com","Ariola, Elena M"],
["timberry101@aol.com","Berry, Nicole J"],
["kattimberry@aol.com","Berry, Nicole J"],
["lasirena1981@yahoo.com","Castellanos, Omar O"],
["jomac681@yahoo.com","Cohen, Kayla M"],
["Eastern10704@yahoo.com","Cohen, Kayla M"],
["conboyclan10@charter.net","Conboy, Zachary T"],
["rob.conboy@sodexo.com","Conboy, Zachary T"],
["kdragon30@hotmail.com","Delancy, Ashley N"],
["GTLOVE1969@yahoo.com","Doodnauth, Natalie"],
["rich@richelberger.com","Elberger, Audrey C"],
["Tom42668@yahoo.com","Evans, Ryan J"],
["denise726@sbcglobal.net","Evans, Ryan J"],
["kandmford@aol.com","Ford, Liam M"],
["physlop@email.com","Hyslop, Jacqueline S"],
["physlop@mail.com","Hyslop, Jacqueline S"],
["jimnick3@sbcglobal.net","Kelly, Nicholas J"],
["patrickdmaher@att.net","Maher, Shannon M"],
["tracylmaher@att.net","Maher, Shannon M"],
["wmac343434@yahoo.com","McCarthy, Joshua M"],
["wildlifelinect@yahoo.com","McCarthy, Joshua M"],
["asheleyny@yahoo.com","Mone, Katherine L"],
["LisaMotto13@gmail.com","Motto, Juliana R"],
["JoeLisa13@aol.com","Motto, Juliana R"],
["porpora08@live.com","Porpora, Nicholas J"],
["mmprchlik@gmail.com","Prchlik, Megan A"],
["rustinadvantage@hotmail.com","Rustin, Lauren A"],
["dcs049@gmail.com","Schappach, Kaitlin M"],
["zegarellit@msn.com","Zegarelli, Maria J"],
["tdcmzeg@msn.com","Zegarelli, Maria J"],
["Lesly.salazar@newfairfieldschools.org","Salazar, Lesly"]]

geometry_a4 = 
[["maltobelli@prattindustries.com","Altobelli, Michael F"],
["malto95@charter.net","Altobelli, Michael F"],
["pjbauer@verizon.net","Bauer, Jeremy E"],
["therealabw@gmail.com","Bey-Wagner, Claudia J"],
["catherine.wagner@sbcglobal.net","Bey-Wagner, Claudia J"],
["darren@thecacaceteam.com","Cacace, Domenic M"],
["cristiane@thecacaceteam.com","Cacace, Domenic M"],
["casbar18@sbcglobal.net","Castle, Kiley G"],
["jdeldin@bddinsurance.com","Deldin, Arianna R"],
["jldeldin@charter.net","Deldin, Arianna R"],
["dianebely@gmail.com","Grad, Madison A"],
["jgcontract@charter.net","Green, Sean J"],
["mark@hudson-mail.com","Hudson, Hazel V"],
["auntgacki@earthlink.net","Hudson, Hazel V"],
["mkanetkar@gmail.com","Kanetkar, Shreya M"],
["Parag.kanetkar@oracle.com","Kanetkar, Shreya M"],
["teri.linero@yahoo.com","Linero, Giovanni (Gio)"],
["lizamckean@gmail.com","McKean, Caroline E"],
["jamesmckeandvm@gmail.com","McKean, Caroline E"],
["jmcmanemin@earthlink.net","McManemin, Sydney L"],
["mcmaneminfamily@earthlink.net","McManemin, Sydney L"],
["merritt81096@yahoo.com","Merritt, Jake M"],
["merritt7468@yahoo.com","Merritt, Jake M"],
["michelle.montaina@gmail.com","Montaina, Max P"],
["lmontaina@westarmacau.com","Montaina, Max P"],
["vilperlman@gmail.com","Perlman, Arianna L"],
["lmregan2002@yahoo.com","Regan, Brendan"],
["reganrd@gmail.com","Regan, Brendan"],
["gail.t@sbcglobal.net","Rodriguez, Liana M"],
["EWiebke@charter.net","Wiebke, Allison M"],
["mwiebke@charter.net","Wiebke, Allison M"],
["chip@parise.com","Williams Jr., Charles H"],
["brenda.williams@pepsico.com","Williams Jr., Charles H"],
["ZACKEO@aol.com","Zackeo, Jenni C"],
["zarsman@gmail.com","Zars, Gregory E"],
["nadinezars@charter.net","Zars, Gregory E"]]

geometry_a2 = 
[["gregbontempo8@hotmail.com","Bontempo, Ashley"],
["chrystieb@live.com","Bontempo, Ashley"],
["adrianborucinski@sbcglobal.net","Borucinski, Arianna M"],
["Hoopstories@aol.com","Brawley, Wilson J"],
["Jbtaffar@aol.com","Brawley, Wilson J"],
["llcennamo@sbcglobal.net","Cennamo, Matthew B"],
["Leftyf2003@yahoo.com","Clark, Fisher M"],
["KIRICLARK16@gmail.com","Clark, Fisher M"],
["jennhair513@gmail.com","Condon, Samantha E"],
["dacfudge@aol.com","Costanzo, Julia M"],
["zug7@aol.com","Costanzo, Julia M"],
["kacupo@sbcglobal.net","Cupo, Angela R"],
["raymond.donahue@waters.nestle.com","Donahue, Jack T"],
["kathychan@charter.net","Donahue, Jack T"],
["driscolls@comcast.net","Driscoll, Daniel H"],
["sdriscoll23@charter.net","Driscoll, Daniel H"],
["medge60@hotmail.com","Edgerton, Cole D"],
["medgerton@copelandcoating.com","Edgerton, Cole D"],
["kelly.anne.93@gmail.com","Farrell, Sydney"],
["mike.farrell6@gmail.com","Farrell, Sydney"],
["miandmon@sbcglobal.net","Forsberg, Erin E"],
["brian.gephart@utas.utc.com","Gephart, Nicholas J"],
["gephart.jean@newfairfieldschools.org","Gephart, Nicholas J"],
["momoleo65@aol.com","Hernandez, Danielle M"],
["jb@jbharchdesign.net","Hernandez, Danielle M"],
["nimeri32@gmail.com","Imeri, Azra S"],
["jamieson@sbcglobal.net","Jamieson, Sean H"],
["stephaniekersting@yahoo.com","Kersting, Emma D"],
["robertkersting@yahoo.com","Kersting, Emma D"],
["jkunak@skadden.com","Kunak, Brian C"],
["lakbase@yahoo.com","Kunak, Brian C"],
["magnum36@earthlink.net","Lewis, Erin M"],
["queensheba36@earthlink.net","Lewis, Erin M"],
["mcinerney3@yahoo.com","McInerney, John W"],
["mcinerney4@yahoo.com","McInerney, John W"],
["salernobeagles@aol.com","Salerno, Victoria M"],
["agscocozza@sbcglobal.net","Scocozza, Ronan J"],
["kathleenteklits@gmail.com","Teklits, Allison R"],
["andrewteklits@gmail.com","Teklits, Allison R"],
["sscaterina@hotmail.com","Tripaldi Jr., Daniel J"],
["christi.walker@gmail.com","Walker, Spencer J"],
["johnr_walker@hotmail.com","Walker, Spencer J"],
["bkwargin@charter.net","Wargin, Ailis G"],
["kath.warg@gmail.com","Wargin, Ailis G"]]

test = 
[["alexander.f.padron@gmail.com", "Alex"], 
["padron.robin@newfairfieldschools.org", "Mom"], 
["scott.padron1.25@gmail.com", "Scott"],
["robin.padron@gmail.com", "Also Mom"]]
    
not_prepared = "Dear Parent, ::Your child was not prepared for class <DATE>. Since spare items are generally not provided, coming to class unprepared might prevent your child from participating fully in the class. ::Please make sure that your child has all the required supplies, and please remind him or her to bring them to class."

no_homework = "Dear Parent, ::Your child did not turn in his homework that was due <DATE>. ::Completing homework is critical for student success. Strugglig students have many resources available to them. The Student Journal has a concise summary of the section notes; the textbook has clear, worked-out examples. The online version of the textbook has a video of each example, for students who find following the textbook challenging. Students can also get extra help during their study hall by going to the Learning Center. In addition, I am almost always available for extra help before and after school, as well as during my office hours."

$(function() {
    error = "None"
    ip = "<IPADDR>"
    students = []
});

function fileToList(str) {
    list = str.split("\n")
    console.log(list)
}

function setClass(cls) {
    if (cls != "None") {
	clearStudents()
	switch(cls) {
	case "geometry b3":
	    students = geometry_b3.slice(0)
	    break
	case "geometry b4":
	    students = geometry_b4.slice(0)
	    break
	case "geometry a2":
	    students = geometry_a2.slice(0)
	    break
	case "geometry a4":
	    students = geometry_a4.slice(0)
	    break
	case "test":
	    students = test.slice(0)
	    break
	default:
	    console.log("bad class name")
	}
	loadStudents(students)
    }
}
function setError(text) {
    error = text
    $("#errorDisplay").html("Selected Error: " + text)
}

function showEmailStatus(sent_any, failed_any) {
    status_text = $("#status").get(0)
    if (!sent_any && !failed_any) {
	status_text.innerHTML = "Status: Nothing Sent"
    } else if (sent_any && !failed_any) {
	status_text.innerHTML = "Status: Email Sent Successfully"
    } else if (!sent_any && failed_any) {
	status_text.innerHTML = "Status: Sending failed"
    } else {
	status_text.innerHTML = "Status: Bad state - some emails succeeded and some failed"
    }
}

function getError(error) {
    if (error == "no homework") {
	return no_homework
    } else if (error == "not prepared") {
	return not_prepared
    } else {
	return error
    }
}
function sendEmails() {
    if (error != "None") {
	status_text = $("#status").get(0)
	console.log(status_text)
	status_text.innerHTML = "Status: pending"
	sent_any = false
	failed_any = false
	for (i = 0; i < students.length; i++) {
	    student = students[i]
	    if (student.sendEmail) {
		var http = new XMLHttpRequest();
		var url = "http://" + ip + ":8080";
		var params = student.email + ":" + getError(error).replace("<DATE>", $("#date").get(0).value);
		http.open("POST", url, false);
		http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
		try {
		    http.send(params);
		    sent_any = true
		} catch(err) {
		    failed_any = true
		}
	    }
	}
	showEmailStatus(sent_any, failed_any)
	setStudentsToFalse()
    }
}

function colorString(bool) {
    if (bool) {
	return "red"
    } else {
	return "green"
    }
}

function makeHTML(index) {
    student = students[index]
    return "</p><button style=\"color: " + colorString(student.sendEmail) 
	+ "\" onclick=\"clickIndex(" + index + ")\">" + student.name + "</button>"
}

function clickIndex(index) {
    showEmailStatus(false,false)
    students[index].sendEmail = !students[index].sendEmail
    $("#studentContainer").get(0).rows[index].innerHTML = makeHTML(index)
}

function loadStudents(students) {
    for (i = 0; i < students.length; i++) {
	students[i] = {name: students[i][1], email: students[i][0], sendEmail: false}
    }
    studentContainer = $("#studentContainer").get(0)
    for (i = 0; i < students.length; i++) {
	row = studentContainer.insertRow(-1);
	row.innerHTML = makeHTML(i)
    }
}

function clearStudents() {
    studentContainer = $("#studentContainer").get(0)
    for (i = 0; i < students.length; i++) {
	studentContainer.deleteRow(0)
    }
}

function setStudentsToFalse() {
    for (i = 0; i < students.length; i++) {
	students[i].sendEmail = false
	$("#studentContainer").get(0).rows[i].innerHTML = makeHTML(i)
    }
}
